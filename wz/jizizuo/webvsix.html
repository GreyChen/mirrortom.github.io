<!DOCTYPE html><html lang=en><head><meta charset=utf-8 /><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1" /><meta name=viewport content="width=device-width,initial-scale=1.0,user-scalable=no" /><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png /><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png /><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png /><link rel=manifest href=/site.webmanifest /><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5 /><meta name=msapplication-TileColor content=#da532c /><meta name=theme-color content=#ffffff /><title>文章 | Mirror Space</title><link href=/mirrorui/mirrorui.css rel=stylesheet /><style scoped>.layout{display:grid;grid-template-columns:210px auto;min-height:100vh}.layout-right{padding:30px}</style></head><body><div class=layout><div class=layout-left><link href=/asset/css/mainmenu.css rel=stylesheet /><div class=mainmenu><div class=logobox><img src=/asset/img/logo.jpg class=logoimg /></div><h3>Mirror Space</h3><hr class=line /><a href=/index.html><h4>Home</h4></a> <a href=/about.html><h4>About</h4></a> <a href=/projectinfo.html><h4>Info</h4></a><div class=theme id=themebox><span onclick=changetheme(1) class="btn link sm">白天sun</span> <span onclick=changetheme(2) class="btn link sm">夜晚moon</span><br /> <span onclick=changefontsize(14) class="btn link sm">A</span> <span onclick=changefontsize(16) class="btn link sm">AA</span> <span onclick=changefontsize(20) class="btn link sm">AAA</span></div></div><script src=/asset/js/mainmenu.js></script></div><div class=layout-right><div class=wz-page><div><div id=article_headerbox></div><a onclick=window.history.back() class="btn link danger">返回上页</a><hr class=line /></div><script src=/asset/js/article.js></script><script>(()=>{let f=window.location.pathname,u=f.split("/"),e="article_"+u[2],t=JSON.parse(window.sessionStorage.getItem(e)),i=u[3].replace(".html",""),n={};n.t=t[i][0];n.d=t[i][1];n.a=t[i][2];let r=`<h1 class="text-center">${n.t}</h1>`;r+=`<h5>作者:&emsp;<span></span>${n.a}</h5>`;r+=`<h5>日期:&emsp;<span></span>${n.d}</h5>`;let o=window.document.querySelector("#article_headerbox");o.innerHTML=r})()</script><h2>概述</h2><p>2018年时想做一个使用C# razor语法写html页面工具.当时研究了asp.net的razor后没找到生成静态页面的办法,后来使用了三方的RazorEngine开源库,得以实现.</p><p>原理是使用RazorEngine提供的方法,将Razor页面编译成静态html.为了方便使用,做成了vs插件.支持在vs2017上使用</p><h2>插件使用</h2><p>在vs2017安装这个插件,安装方法是找到插件项目的编译目录,运行WebFilePublishVSIX.vsix这个文件.按提示安装,过程中会要求关闭vs.</p><p>打开或者新建一个项目,添加几个web文件,如home.js,home.css,home.cshtml"</p><h4>发布文件 / 发布目录 / 发布项目</h4><p>插件的三个功能,分别针对文件,目录,整个项目.可以发布项目中选中的单个或多个文件,目录.发布项目则是编译项目后,发布所有文件.</p><p>在项目管理窗口中,右击一个(或多个)文件,点击菜单项 "发布文件 Alt+1 Alt+1" 可以发布该文件.</p><p>当前正在编辑的文件可以按Alt+QQ发布.为了便于修改文件后马上发布.</p><p>同理,右击文件夹时,会发布文件夹中的所有文件.</p><p>右击项目时,点击菜单项"发布web",这时会先编译该项目,然后发布项目中所有文件.</p><p>发布时会判断文件类型,如果是js,css,jpg等web静态文件,则会直接复制到发布目录.cshtml文件会编译成html输出,这是插件的主要功能.</p><h2>配置文件</h2><p>发布功能由配置文件设定,文件位于项目根目录下,默认名"publish.json",每次发布动作时,会读取这个文件.插件项目有个默认模板在 "/JsonCfg/publish.json".</p><p>配置文件可以设定发布到哪个目录,允许发布文件,不允许发布文件,发布前是否清空发布目录.没有配置文件时,会使用默认配置.</p>
  <pre>
{
  // 源文件目录名(例如:src/ 不能以/或者\开头,是相对路径,相对于项目根目录.结尾有/)
  "sourceDir": "src/",
  // 发布目录名(例如: 'dist/' 或 'd:/pubdir/' 相对路径或绝对路径,相对路径不以/或\开头,结尾有/)
  "distDir": "dist/",
  // 发布整个项目时,发布前删除发布目录所有内容
  "emptyPublishDir": "true",
  // 发布整个项目时,编译项目后发布bin文件夹
  "buildBin": "false",
  // 对js,css,html压缩输出(0=不压缩,7=都压缩. 1=html,2=css,4=js)
  "miniOutput": 7,
  // 允许发布的文件扩展名
  "allowExts": [ ".htm", ".html", ".cshtml", ".config", ".js", ".css", ".json", ".jpg", ".jpeg", ".gif", ".png", ".bmp", ".woff", ".woff2", ".ttf", ".svg", ".eot", ".otf" ],
  // 不允许发布的文件后缀名
  "denySuffix": [ "layout.cshtml", "part.cshtml", "part.js", "part.css" ],
  // 不允许发布的文件(例如:bundleconfig.json data/data.mdb 不能以/或者\开头,是带相对路径的文件名,相对于项目根目录)
  "denyFiles": [],
  // 不允许发布的目录(例如:src/ 不能以/或者\开头,是相对路径,相对于项目根目录.结尾有/)
  "denyDirs": [],
  // 公共变量,一个json键值对例如{k:v,...},将作为匿名对象作为Model传给cshtml文件,调用方法@Model.xxx
  "GlobleVar": null
}
  </pre><h2>RazorEngine</h2><p>razorengine开源项目文档地址 <a href=https://antaris.github.io/RazorEngine/index.html target=_blank>https://antaris.github.io/RazorEngine/index.html</a></p><p>项目git地址 <a href=https://github.com/Antaris/RazorEngine target=_blank>https://github.com/Antaris/RazorEngine</a></p><p>编译生成razor页面时,RazorEngine要使用RoslynCompiler工具编译.否则会出现编译卡死.在控制台程序中,默认的编译工具不会有问题,但做到插件中后出现卡死.</p><h3>cshtml文件</h3><p>基本上与razor用法一样,但是可用的功能非常少.</p><h4>引用母版页</h4>
  <pre>
        @{
            // 使用母板页.(母板页只能引用一个,并且写在页面开始处)
            Layout="/src/layout/layout.cshtml";
        }
        </pre><h4>引用部分页</h4>
  <pre>
        &lt;div>
            // 引入了一个分部页.(可以引用多个)
            @Include("/src/a_1.part.cshtml"); 
            // 递归的 : a_1.part.cshtml中也支持再引用layout和Include.
        &lt;/div>
        </pre><h4>命名约定</h4><p>母版页名字约定后缀:layout.cshtml,片段页约定:part.cshtml</p><h4>母板页示例</h4>
  <pre>
        &lt;!DOCTYPE html>
        &lt;html lang="en">
            &lt;head>
                &lt;meta charset="utf-8">
                &lt;meta http-equiv="X-UA-Compatible" content="IE=edge">
                &lt;meta name="viewport" content="width=device-width,initial-scale=1.0">
                &lt;link href="base.css" rel="stylesheet" />
                &lt;title>@ViewBag.Title&lt;/title>
            &lt;/head>
            &lt;body>
                @RenderBody()
            &lt;/body>
        &lt;/html>
        </pre><h4>主页面示例</h4>
  <pre>
        @{
            // 引用母板页
            Layout = "/layout.cshtml";
            // 对应母板页中的@ViewBag.Title
            ViewBag.Title = "页面标题-razorengine.dll";
            // 页面变量
            string hi = "hello world";
            string html = "&lt;h1>hello world&lt;/h1>";
        }
        &lt;div>@hi&lt;/div>
        // 如果变量是Html标记,可以使用Raw方法.否则输出字符串
        &lt;div>@Raw(html)&lt;/div>
        // C#代码,这种行为和php那种内嵌一样的
        @for (int i = 0; i &lt; 10; i++)
        {
            &lt;div>循环输出 @i&lt;/div>
        }
        </pre><h4>公用变量</h4><p>配置文件中的GlobleVar属性,可写一些常量值.值的形式是json键值对.例如{name:xxx,title:xxx},在编译cshtml时,将作为Model传入</p><p>在cshtml中引用如下 @Model.name 和Razor语法一样.这里所有cshtml文件都是这一份Model,所以只能写些全局常用值</p><h2>vs平台的前端打包工具</h2><p>相比于node平台的webpack等前端打包工具的热度,vs平台就比较冷清,虽然功能上并不缺少,但在前后端分离之后,几乎很少有用vs平台做前端的了吧.</p><p>这个插件解决html生成问题,css,js的话,可以安装这几个插件,打包js成一个文件,编译less,scss,stylus等,非常好用.这样看来,vs工具做前端工程也较便利了.</p><h4>NUglify</h4><p>C#版本的压缩库,除了js,css外,主要是能压缩html.这个不是VS插件项目,是个工具库.可以做到自己的插件里</p><p>地址: <a href=https://github.com/xoofx/NUglify target=_blank>https://github.com/xoofx/NUglify</a></p><h4>BundlerMinifier</h4><p>是VS插件,可以压缩js,将多个js合并成一个js.</p><p>地址: <a href=https://github.com/madskristensen/BundlerMinifier target=_blank>https://github.com/madskristensen/BundlerMinifier</a></p><h4>WebCompiler</h4><p>这个插件很全面,能压缩js,css,html.还能处理css预编译语言scss,stylus</p><p>地址: <a href=https://github.com/madskristensen/WebCompiler target=_blank>https://github.com/madskristensen/WebCompiler</a></p><h4>ImageSprites</h4><p>是VS插件,将图片合成一张图片,然后自动生成css的位置.做css裁剪时,再也不能量位置了</p><p>地址: <a href=https://github.com/madskristensen/ImageSprites target=_blank>https://github.com/madskristensen/ImageSprites</a></p><h4>ImageOptimizer</h4><p>是VS插件,能将图片缩小.类似熊猫压缩图片那种功能</p><p>地址: <a href=https://github.com/madskristensen/ImageOptimizer target=_blank>https://github.com/madskristensen/ImageOptimizer</a></p><h4>这个项目</h4><p>插件项目git: <a href=https://github.com/mirrortom/WebFilePublishVSIX target=_blank>https://github.com/mirrortom/WebFilePublishVSIX</a></p></div></div></div></body></html>