<!DOCTYPE html><html lang=en><head><meta charset=utf-8 /><meta http-equiv=X-UA-Compatible content="IE=edge" /><meta name=viewport content="width=device-width,initial-scale=1.0" /><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png /><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png /><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png /><link rel=manifest href=/site.webmanifest /><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5 /><meta name=msapplication-TileColor content=#da532c /><meta name=theme-color content=#ffffff /><title>分离轴理论 | Mirror Space</title><link href=/mirrorui/mirrorui.css rel=stylesheet /><style scoped>.layout{display:grid;grid-template-columns:210px auto;min-height:100vh}.layout-right{padding:30px}</style></head><body><div class=layout><div class=layout-left><style>.mainmenu{position:sticky;top:122px;text-align:center}.mainmenu a{color:var(--graybackse);text-decoration:none}.mainmenu a:hover,.mainmenu a.active{color:var(--fontcolor);text-decoration:underline}.logobox{width:144px;height:144px;overflow:hidden;border-radius:50%;margin:22px auto}.logoimg{margin-left:-56px;animation:circleRoate 6s infinite linear}@keyframes circleRoate{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}</style><div class=mainmenu><div class=logobox><img src=/asset/img/logo.jpg class=logoimg /></div><h3>Mirror Space</h3><hr class=line /><a href=/index.html><h4>Home</h4></a> <a href=/about.html><h4>About</h4></a> <a href=/projectinfo.html><h4>Info</h4></a></div></div><div class=layout-right><div class=wz-page><div><div id=article_headerbox></div><a onclick=window.history.back() class="btn link danger">返回上页</a><hr class=line /></div><script src=/asset/js/article.js></script><script>(()=>{let f=window.location.pathname,u=f.split("/"),e="article_"+u[2],t=JSON.parse(window.sessionStorage.getItem(e)),i=u[3].replace(".html",""),n={};n.t=t[i][0];n.d=t[i][1];n.a=t[i][2];let r=`<h1 class="text-center">${n.t}</h1>`;r+=`<h5>作者:&emsp;<span></span>${n.a}</h5>`;r+=`<h5>日期:&emsp;<span></span>${n.d}</h5>`;let o=window.document.querySelector("#article_headerbox");o.innerHTML=r})()</script><h2>分离轴定理 Separating Axis Theorem</h2><p>分离轴定理用于判断两个凸多边形是否碰撞.原理的理解如下:</p><p>有两个凸多边形,在一个方向上,用一束光照射,得到两个凸多边形的投影.如果投影有间隙,说明这两个凸多边形没有碰撞.如果没有间隙,可能</p><p>是碰撞的.再换一个方向,用光照射,如果还没有间隙,则可能是碰撞的.再换方向...如此反复,直到所有方向照射的投影都没有间隙,则是碰撞的.</p><p>只要在一个方向上有间隙,就能说明没有碰撞.</p><p>只能用于凸多边形,即内角小于180度的多边形.例如正五边形.五角星不是凸多边形,不适用此法.</p><h3>投影</h3><p>从一个方向,光束照射在凸多边形上,得到的投影.下图假设从上往下,从左往右,两个方向照射,得到的投影用多边形的颜色区分.</p><p>观看投影,发现两个方向的投影都有重叠.可是事实上,这两个物体并没有碰撞.</p><canvas id=canvas1></canvas><p>按照定义,两个物体没有碰撞,那么一定能够找到有间隙的投影.</p><p>下图黄色线就是这个间隙</p><canvas id=canvas2></canvas><h3>轴</h3><p>如上图,阴影所在的线称为"投影轴".如上上图,投影轴就是画布的下边界和右边界.</p><p>这条轴是怎么确定的呢?由图可见,这投影轴并不一定要在图中所示位置,是可以靠前或者靠后,只要与轴平行.其实,投影轴有无数条</p><p>由图可见,投影轴与投射光线垂直.所以,投影轴其实由投射光线决定.</p><h3>投射光线与投影轴</h3><p>那么,投射光线的方向怎么决定?应该说是,从哪个方向做投影.事实上,可以从360度的全部方位进行投影.</p><p>上图就是所有360度方位中的一个方位,此方位的投影找到了间隙,说明了那两个物体没有碰撞.</p><p>SAT定理可以这样看,对于上图的两个物体,拿电灯(点光源)照射,看阴影是否有间隙.将电灯围着两个物体转一圈(360度),如果阴影始终是</p><p>有重叠的,那说明碰撞了.如果在任何一个角度上,阴影有间隙,那就说明没有碰撞.</p><h3>凸多边形的边</h3><p>程序上不用检测360度全方位,只需要检测一些特定的角度就可以.</p><p>凸多边形的每一条边就是一个投射光线的方向.如上图,两个物体一共有7条边,那么只要检测这7个方向就能判断是否碰撞</p><p>而且,只要有一个方向发现阴影有间隙,就说明没有碰撞.剩下的方向就不用检测了</p><h3>检测凸多边形投影</h3><p>实现第一个方法,给定一个多边形,检测它的投影.按边的顺时针方向,求出凸多边形在所有边的投影轴上的投影.</p><p>此方法的关键点是要计算出投影轴的合适位置和投影点的位置.每一条投影轴上有n-1个顶点的投影(投影光线(边)所在的两点重合了)</p><p></p><p>下图按方向 ab - bc - cd - da ...分别画出投影轴和投影点,这两个凸多边形有9条边,所以有9条投影轴</p><p>在绘画时,使用坐标系变换.例如,ab边为投影光线,那么,将canvas坐标系平移到a点,再旋转ab线段的斜率对应的角度,</p><p>(即以ab线段所在的直线为X轴,a是原点,b是正方向上一点).这时,投影轴在变换后的坐标系中,是一条与Y轴平行的直线.</p><p>此时再计算出其它顶点在新坐标系的坐标值,这些点的Y值的最大值和最小值就是投影轴的Y值端点范围.而X值中的最大值加上</p><p>合适的距离(如20px)就是投影轴的X值.这样,投影轴就画出来了.投影轴上各顶点的投影点,它们的X值就是投影轴的X值,而Y值</p><p>就是这些点的Y值.</p><div class=grids><canvas id=canvas3></canvas><div><p><span class=label>蓝色多边形</span></p><div id=poly1btnbox></div><br /><p><span class=label>橄榄色多边形</span></p><div id=poly2btnbox></div></div></div><h3>碰撞判断</h3><p>上图,投影点有重合的投影轴,是青绿色的.</p><p>实现上面的投影检测后,就已经可也判断碰撞了.判断投影点是否有空隙,只要判断两个凸多边形的投影点坐标是否有交集</p><p>举例说明,在一个投影轴上,多边形1的投影点的Y坐标(排序后)为[1,3,6,9],多边形2的Y坐标为[10,12,13],那么显然是没有交集的</p><p>所以不碰撞.如果是[1,2,5]和[4,8,9]那么是有交集的,多边形2的第一个点[4],在多边形1的第2个点和第3个点之间[2,5],此时要</p><p>判断下一个投影轴,按照SAT定义,如果所有投影轴都有交集,那么两个多边形是碰撞的</p><p>为什么只检查Y(或者X,投影轴水平时)坐标就能判断交集呢?因为点都在同一条线上(投影轴,投影点).可以当作数轴看待.</p><h3>圆与凸多边形</h3><p>两个圆形碰撞检测,只需要判断两个圆的圆心距离是否小于两个半径之和</p><p>下图r1,r2半径之和小于r1r2圆心的距离,所以不碰撞.r3,r4圆心距离小于半径之和,所以碰撞了</p><div class=grids><canvas id=canvas4></canvas><canvas id=canvas5></canvas></div><p>圆可以从0~360度方向投影,和多边形不同,圆的边可以是无数条,没法用边做投影光线方向.</p><p>选取半径为投影光线方向,从与X轴重合的半径开始,顺时针每120度,取一条半径做一个投影</p><p>圆的投影点总是两个,距离就是圆的直径.</p><canvas id=canvas6></canvas><h3>程序测验</h3></div><script>function canva6(){let n=getCanvas2d("canvas6"),t={x:150,y:70,r:40,bg:"steelblue"};n.arc(t.x,t.y,t.r,0,Math.PI*2);n.fillStyle=t.bg;n.fill();n.beginPath();n.arc(t.x,t.y,2,0,Math.PI*2);n.fillStyle="red";n.fill();n.save();n.translate(t.x,t.y);for(var i=0;i<3;i++){n.save();let r=t.r+20;n.rotate(Math.PI*2*i/3);n.save();n.beginPath();n.setLineDash([5]);n.strokeStyle=n.fillStyle="orangered";lineArrow(n,[0,0,r+10,0],10);n.restore();n.beginPath();n.moveTo(r,-t.r-15);n.lineTo(r,t.r+15);n.strokeStyle="gray";n.stroke();n.beginPath();n.arc(r,-t.r,2,0,Math.PI*2);n.arc(r,t.r,2,0,Math.PI*2);n.fillStyle="blue";n.fill();n.restore()}n.restore()}function canva5(){let i=getCanvas2d("canvas5");i.font="16px serial";i.textAlign="center";let n={x:20,y:70,r:28,speed:15,bg:"gray"},t={x:275,y:50,r:35,speed:-25,bg:"steelblue"},r=[n,t],u=0,f=e=>{let s=e-u;u=e;i.clearRect(0,0,300,150);for(var o=0;o<r.length;o++)i.beginPath(),i.arc(r[o].x,r[o].y,r[o].r,0,Math.PI*2),i.fillStyle=r[o].bg,i.fill(),i.beginPath(),i.fillStyle="darkblue",i.fillText(Math.abs(r[o].speed)+"px/s",r[o].x,r[o].y);if((n.y-t.y)*(n.y-t.y)+(n.x-t.x)*(n.x-t.x)<(n.r+t.r)*(n.r+t.r)){n.speed=-n.speed+(n.speed>0?-randInt(1,10):+randInt(1,10));t.speed=-t.speed+(t.speed>0?-randInt(1,10):+randInt(1,10));i.save();i.translate(n.x,n.y);i.rotate(Math.atan((n.y-t.y)/(n.x-t.x)));let r=n.r+t.r;i.moveTo(n.r,r);i.lineTo(n.r,-r);i.strokeStyle="red";i.stroke();i.beginPath();i.moveTo(0,0);i.lineTo(r,0);i.stroke();i.restore();setTimeout(()=>{n.x-=1,u+=1e3,window.requestAnimationFrame(f)},1e3);return}n.x+=n.speed*s/1e3;t.x+=t.speed*s/1e3;n.x<n.r?(n.x=n.r,n.speed=randInt(10,30)):n.x>300-n.r&&(n.x=300-n.r,n.speed=-randInt(10,30));t.x<t.r?(t.x=t.r,t.speed=randInt(10,30)):t.x>300-t.r&&(t.x=300-t.r,t.speed=-randInt(10,30));window.requestAnimationFrame(f)};window.requestAnimationFrame(f)}function canva4(){var t;let n=getCanvas2d("canvas4");n.font="18px serial";let i={x:20,y:70,r:20,bg:"gray"},r={x:90,y:50,r:25,bg:"steelblue"},u={x:180,y:90,r:35,bg:"olive"},f={x:210,y:40,r:30,bg:"chartreuse"},e=[i,r,u,f];for(t=0;t<e.length;t++){let i=e[t];n.beginPath();n.arc(i.x,i.y,i.r,0,Math.PI*2);n.fillStyle=i.bg;n.fill();n.fillText(`r${t+1} = ${i.r}`,i.x-10,i.y+i.r+15);n.beginPath();n.arc(i.x,i.y,2,0,Math.PI*2);n.fillStyle="black";n.fill()}for(n.beginPath(),n.strokeStyle="red",t=0;t<e.length;t++)n.lineTo(e[t].x,e[t].y);n.stroke();let o=Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y)),s=Math.sqrt((u.x-f.x)*(u.x-f.x)+(u.y-f.y)*(u.y-f.y));n.fillText("r1r2 = "+parseFloat(o.toFixed(2)),10,20);n.fillText("r3r4 = "+parseFloat(s.toFixed(2)),140,20)}function createBtn(n,t){var i;let u=document.querySelector("#"+t),r=[];for(i=0;i<n.length/2;i++){let t=String.fromCharCode(97+i)+String.fromCharCode(97+(i==n.length/2-1?0:i+1));r.push({name:t,order:i})}let f="";for(i=0;i<r.length;i++)f+=`<input class="input-check" type="checkbox" title=${r[i].order} id="${t}_${i}" />
      <label class="input-check-label" for="${t}_${i}"><b class="check"></b>${r[i].name}</label><br>`;u.innerHTML=f;u.querySelectorAll(".input-check").forEach(n=>{n.onclick=n=>{n.stopPropagation();let r=document.querySelector("#poly1btnbox"),u=document.querySelector("#poly2btnbox"),f=r.querySelectorAll(".input-check:checked"),e=u.querySelectorAll(".input-check:checked"),t=[],i=[];f.forEach(n=>{t.push(parseInt(n.title))});e.forEach(n=>{i.push(parseInt(n.title))});canva3(t,i,!1)},n.checked=!0})}function canva3(n=null,t=null,i=true){var u,f,s;let r=getCanvas2d("canvas3");r.canvas.width=500;r.canvas.height=380;r.font="16px serial";let e=[110,130,210,100,210,170,90,220];drawPolygon(r,e,"steelblue");let o=[240,120,350,120,370,140,310,230,275,250];for(drawPolygon(r,o,"olive"),i==!0&&(createBtn(e,"poly1btnbox"),createBtn(o,"poly2btnbox")),r.fillStyle="brown",u=0,f=0;u<e.length;u+=2,f++)r.fillText(String.fromCharCode(65+f),e[u],e[u+1]);for(u=0,f=0;u<o.length;u+=2,f++)r.fillText(String.fromCharCode(65+f),o[u],o[u+1]);let h=getK(e),c=getK(o);for(u=0;u<h.length;u++)if(n==null||!(n.indexOf(u)<0)){let p=h[u],v=p==null?Math.PI/2:Math.atan(p),i={ox:e[2*u],oy:e[2*u+1]},c={x:e[2*u+2],y:e[2*u+3]};u==h.length-1&&(c={x:e[0],y:e[1]});let t=[{x:0,y:0}];for(t[1]=trsPoint(c.x,c.y,[i,{angle:v}]),f=0;f<e.length;f+=2){let n={x:e[f],y:e[f+1]};(n.x!=i.ox||n.y!=i.oy)&&(n.x!=c.x||n.y!=c.y)&&t.push(trsPoint(n.x,n.y,[i,{angle:v}]))}let l=[];for(f=0;f<o.length;f+=2){let n={x:o[f],y:o[f+1]};l.push(trsPoint(n.x,n.y,[i,{angle:v}]))}let y=maxPoint(t.concat(l)),a=t[1].x>0?y.maxx.x+20:y.minx.x-20,d=y.miny.y-20,g=y.maxy.y+20,w=!1,b=maxPoint(t),k=maxPoint(l);for(b.miny.y>k.maxy.y||b.maxy.y<k.miny.y||(w=!0),r.save(),r.translate(i.ox,i.oy),r.rotate(v),r.save(),r.beginPath(),r.setLineDash([5]),r.strokeStyle=r.fillStyle="orangered",lineArrow(r,[0,0,a+(t[1].x>0?10:-10),0],10),r.restore(),r.beginPath(),r.moveTo(a,d),r.lineTo(a,g),r.strokeStyle=w==!0?"chartreuse":"gray",r.stroke(),r.fillStyle="blue",s=0;s<t.length;s++)r.beginPath(),r.arc(a,t[s].y,2,0,Math.PI*2),r.fill();for(r.fillStyle="olive",s=0;s<l.length;s++)r.beginPath(),r.arc(a,l[s].y,2,0,Math.PI*2),r.fill();r.restore()}for(u=0;u<c.length;u++)if(t==null||!(t.indexOf(u)<0)){let k=c[u],v=Math.atan(k),i={ox:o[2*u],oy:o[2*u+1]},h={x:o[2*u+2],y:o[2*u+3]};u==c.length-1&&(h={x:o[0],y:o[1]});let n=[{x:0,y:0}];for(n[1]=trsPoint(h.x,h.y,[i,{angle:v}]),f=0;f<o.length;f+=2){let t={x:o[f],y:o[f+1]};(t.x!=i.ox||t.y!=i.oy)&&(t.x!=h.x||t.y!=h.y)&&n.push(trsPoint(t.x,t.y,[i,{angle:v}]))}let l=[];for(f=0;f<e.length;f+=2){let n={x:e[f],y:e[f+1]};l.push(trsPoint(n.x,n.y,[i,{angle:v}]))}let y=maxPoint(n.concat(l)),a=n[1].x>0?y.maxx.x+20:y.minx.x-20,d=y.miny.y-20,g=y.maxy.y+20,p=!1,w=maxPoint(n),b=maxPoint(l);for(w.miny.y>b.maxy.y||w.maxy.y<b.miny.y||(p=!0),r.save(),r.translate(i.ox,i.oy),r.rotate(v),r.save(),r.beginPath(),r.setLineDash([5]),r.strokeStyle=r.fillStyle="orangered",lineArrow(r,[0,0,a+(n[1].x>0?10:-10),0],10),r.restore(),r.beginPath(),r.moveTo(a,d),r.lineTo(a,g),r.strokeStyle=p==!0?"chartreuse":"gray",r.stroke(),r.fillStyle="olive",s=0;s<n.length;s++)r.beginPath(),r.arc(a,n[s].y,2,0,Math.PI*2),r.fill();for(r.fillStyle="blue",s=0;s<l.length;s++)r.beginPath(),r.arc(a,l[s].y,2,0,Math.PI*2),r.fill();r.restore()}}function trsPoint(n,t,i){let r={x:n,y:t};for(var u=0;u<i.length;u++){let n=i[u];n.hasOwnProperty("ox")?r=translatePoint(r.x,r.y,n.ox,n.oy):n.hasOwnProperty("angle")?r=rotatePoint(r.x,r.y,n.angle):n.hasOwnProperty("zx")&&(r=scalePoint(r.x,r.y,n.zx,n.zy))}return r}function translatePoint(n,t,i,r){let u=n-i,f=t-r;return{x:u,y:f}}function rotatePoint(n,t,i){let r=n*Math.cos(i)+t*Math.sin(i),u=t*Math.cos(i)-n*Math.sin(i);return{x:parseFloat(r.toFixed(4)),y:parseFloat(u.toFixed(4))}}function scalePoint(n,t,i,r){let u=n/i,f=t/r;return{x:u,y:f}}function canva2(){let n=getCanvas2d("canvas2");n.canvas.width=400;n.canvas.height=200;n.font="16px serial";let t=[100,40,120,120,160,50];drawPolygon(n,t,"blue");let e=[190,90,140,100,190,30,225,40];drawPolygon(n,e,"red");let u=(t[5]-t[3])/(t[4]-t[2]),f=t.concat(e);for(var i=0;i<f.length;i+=2){let t=f[i],r=f[i+1],e=0,o=r+u*(e-t);shadowGuide(n,[t,r,e,o],"gray",1)}let r=-1/u,o=0,s=110,h=200,tt=s+r*(h-o);shadowLine(n,o,s,h,tt,"black",1);let c=0,l=90,a=200,it=l+r*(a-c);shadowLine(n,c,l,a,it,"green",1);let v=45,y=135,p=95,rt=y+r*(p-v);shadowLine(n,v,y,p,rt,"blue",4);let w=102,b=166,k=140,ut=b+r*(k-w);shadowLine(n,w,b,k,ut,"red",4);let d=193,g=0,nt=70,ft=g+u*(nt-d);shadowLine(n,d,g,nt,ft,"gold",4)}function canva1(){let n=getCanvas2d("canvas1"),r=400,u=200;n.canvas.width=r;n.canvas.height=u;n.font="16px serial";let f=[100,40,120,120,160,50];drawPolygon(n,f,"blue");let e=[190,90,140,100,190,30,225,40];drawPolygon(n,e,"red");let t=maxXY(f),i=maxXY(e);n.save();n.setLineDash([5]);lineArrow(n,[0,60,60,60],8);n.fillText("光线",2,80);lineArrow(n,[180,0,180,15],8);n.fillText("光线",185,20);n.restore();shadowLine(n,r-4,t.miny,r-4,t.maxy,"blue",4);shadowLine(n,r-4,i.miny,r-4,i.maxy,"red",4);shadowGuide(n,[0,t.miny,r,t.miny],"blue",1);shadowGuide(n,[0,t.maxy,r,t.maxy],"blue",1);shadowGuide(n,[0,i.miny,r,i.miny],"red",1);shadowGuide(n,[0,i.maxy,r,i.maxy],"red",1);shadowLine(n,t.minx,u-4,t.maxx,u-4,"blue",4);shadowLine(n,i.minx,u-4,i.maxx,u-4,"red",4);shadowGuide(n,[t.minx,0,t.minx,u],"blue",1);shadowGuide(n,[t.maxx,0,t.maxx,u],"blue",1);shadowGuide(n,[i.minx,0,i.minx,u],"red",1);shadowGuide(n,[i.maxx,0,i.maxx,u],"red",1)}function shadowLine(n,t,i,r,u,f,e){n.save();n.beginPath();n.globalAlpha=.5;f&&(n.strokeStyle=f);e&&(n.lineWidth=e);n.moveTo(t,i);n.lineTo(r,u);n.stroke();n.restore()}function shadowGuide(n,t,i,r){n.save();i&&(n.strokeStyle=i);r&&(n.lineWidth=r);n.beginPath();n.setLineDash([5]);n.moveTo(t[0],t[1]);for(var u=2;u<t.length;u+=2)n.lineTo(t[u],t[u+1]);n.stroke();n.restore()}function maxXY(n){let t=n[0],i=n[1],u=t,f=i;for(var r=2;r<n.length;r+=2){let e=n[r];t=Math.max(t,e);u=Math.min(u,e);let o=n[r+1];i=Math.max(i,o);f=Math.min(f,o)}return{maxx:t,maxy:i,minx:u,miny:f}}function maxPoint(n){let i={x:n[0].x,y:n[0].y};maxY={x:n[0].x,y:n[0].y};let r={x:n[0].x,y:n[0].y},u={x:n[0].x,y:n[0].y};for(var t=1;t<n.length;t++)i.x<n[t].x&&(i.x=n[t].x,i.y=n[t].y),r.x>n[t].x&&(r.x=n[t].x,r.y=n[t].y),maxY.y<n[t].y&&(maxY.x=n[t].x,maxY.y=n[t].y),u.y>n[t].y&&(u.x=n[t].x,u.y=n[t].y);return{maxx:i,maxy:maxY,minx:r,miny:u}}function drawPolygon(n,t,i){n.save();i&&(n.fillStyle=i);n.beginPath();n.moveTo(t[0],t[1]);for(var r=2;r<t.length;r+=2)n.lineTo(t[r],t[r+1]);n.closePath();n.fill();n.restore()}function getK(n){let i=n.concat(n[0],n[1]),r=[];for(var t=0;t<i.length-2;t+=2){let n=i[t+3]-i[t+1],u=i[t+2]-i[t];if(n==0){r.push(0);continue}if(u==0){r.push(null);continue}r.push(n/u)}return r}function lineArrow(n,t,i=12,r=10,u=true){n.beginPath();n.moveTo(t[0],t[1]);for(var o=2;o<t.length;o+=2)n.lineTo(t[o],t[o+1]);n.stroke();let f={x:t[t.length-2],y:t[t.length-1]},e={x:t[t.length-4],y:t[t.length-3]},s=0;if(f.x==e.x)n.save(),n.translate(f.x,f.y),n.rotate(Math.PI/2),n.beginPath(),s=f.y>e.y?r:-r;else{let t=(f.y-e.y)/(e.x-f.x);n.save();n.translate(f.x,f.y);n.rotate(-Math.atan(t));s=f.x>e.x?r:-r}n.beginPath();n.moveTo(0,-i/2);n.lineTo(0,i/2);n.lineTo(s,0);n.closePath();u==!0?n.fill():n.stroke();n.restore()}function randInt(n,t){let i=Math.random()*(t-n);return Math.floor(i)+n}function getCanvas2d(n){let t=document.querySelector("#"+n);t.style.display="block";t.style.margin="20px";t.style.backgroundColor="#f0f0f0";return t.getContext("2d")}canva1();canva2();canva3();canva4();canva5();canva6()</script></div></div></body></html>