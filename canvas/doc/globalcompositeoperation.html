<!DOCTYPE html><html lang=en><head><meta charset=utf-8 /><meta http-equiv=X-UA-Compatible content="IE=edge" /><meta name=viewport content="width=device-width,initial-scale=1.0" /><link href=/mirrorui/mirrorui.css rel=stylesheet /><title>globalCompositeOperation | canvas文档整理 | Mirror Space</title><style>.mainmenubox{position:sticky;top:0;max-height:90vh;overflow:hidden;overflow-y:auto}</style></head><body><p>文档参考1<a href=https://www.canvasapi.cn target=_blank>https://www.canvasapi.cn</a>  文档参考2<a href=https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial target=_blank>https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial</a></p><hr class=line /><div class=grids><div class="grid-2 mainmenubox"><nav class=sidemenu-box id=main_menubox style=max-width:200px><ul class=sidemenu-group><li><span class=sidemenu-label>canvas<i class=sidemenu-arrdown></i></span></li><li><a class=sidemenu-item href=index.html>CanvasRenderingContext2D</a></li><li><a class=sidemenu-item href=todataurl.html>toDataURL</a></li><li><a class=sidemenu-item href=toblob.html>toBlob</a></li></ul><ul class=sidemenu-group><li><span class=sidemenu-label>属性<i class=sidemenu-arrdown></i></span></li><li><a class=sidemenu-item href=canvas.html title=canvas>canvas</a></li><li><a class=sidemenu-item href=currenttransform.html title=currentTransform>currentTransform</a></li><li><a class=sidemenu-item href=direction.html title=direction>direction</a></li><li><a class=sidemenu-item href=fillstyle.html title=fillStyle>fillStyle</a></li><li><a class=sidemenu-item href=filter.html title=filter>filter</a></li><li><a class=sidemenu-item href=font.html title=font>font</a></li><li><a class=sidemenu-item href=globalalpha.html title=globalAlpha>globalAlpha</a></li><li><a class=sidemenu-item href=globalcompositeoperation.html title=globalCompositeOperation>globalCompositeOperation</a></li><li><a class=sidemenu-item href=imagesmoothingenabled.html title=imageSmoothingEnabled>imageSmoothingEnabled</a></li><li><a class=sidemenu-item href=imagesmoothingquality.html title=imageSmoothingQuality>imageSmoothingQuality</a></li><li><a class=sidemenu-item href=linecap.html title=lineCap>lineCap</a></li><li><a class=sidemenu-item href=linedashoffset.html title=lineDashOffset>lineDashOffset</a></li><li><a class=sidemenu-item href=linejoin.html title=lineJoin>lineJoin</a></li><li><a class=sidemenu-item href=linewidth.html title=lineWidth>lineWidth</a></li><li><a class=sidemenu-item href=miterlimit.html title=miterLimit>miterLimit</a></li><li><a class=sidemenu-item href=shadowblur.html title=shadowBlur>shadowBlur</a></li><li><a class=sidemenu-item href=shadowcolor.html title=shadowColor>shadowColor</a></li><li><a class=sidemenu-item href=shadowoffsetx.html title=shadowOffsetX>shadowOffsetX</a></li><li><a class=sidemenu-item href=shadowoffsety.html title=shadowOffsetY>shadowOffsetY</a></li><li><a class=sidemenu-item href=strokestyle.html title=strokeStyle>strokeStyle</a></li><li><a class=sidemenu-item href=textalign.html title=textAlign>textAlign</a></li><li><a class=sidemenu-item href=textbaseline.html title=textBaseline>textBaseline</a></li></ul><ul class=sidemenu-group><li><span class=sidemenu-label>方法<i class=sidemenu-arrdown></i></span></li><li><a class=sidemenu-item href=addhitregion.html title=addHitRegion>addHitRegion()</a></li><li><a class=sidemenu-item href=arc.html title=arc>arc()</a></li><li><a class=sidemenu-item href=arcto.html title=arcTo>arcTo()</a></li><li><a class=sidemenu-item href=beginpath.html title=beginPath>beginPath()</a></li><li><a class=sidemenu-item href=beziercurveto.html title=bezierCurveTo>bezierCurveTo()</a></li><li><a class=sidemenu-item href=clearhitregions.html title=clearHitRegions>clearHitRegions()</a></li><li><a class=sidemenu-item href=clearrect.html title=clearRect>clearRect()</a></li><li><a class=sidemenu-item href=clip.html title=clip>clip()</a></li><li><a class=sidemenu-item href=closepath.html title=closePath>closePath()</a></li><li><a class=sidemenu-item href=createimagedata.html title=createImageData>createImageData()</a></li><li><a class=sidemenu-item href=createlineargradient.html title=createLinearGradient>createLinearGradient()</a></li><li><a class=sidemenu-item href=createpattern.html title=createPattern>createPattern()</a></li><li><a class=sidemenu-item href=createradialgradient.html title=createRadialGradient>createRadialGradient()</a></li><li><a class=sidemenu-item href=drawfocusifneeded.html title=drawFocusIfNeeded>drawFocusIfNeeded()</a></li><li><a class=sidemenu-item href=drawimage.html title=drawImage>drawImage()</a></li><li><a class=sidemenu-item href=drawwidgetasonscreen.html title=drawWidgetAsOnScreen>drawWidgetAsOnScreen()</a></li><li><a class=sidemenu-item href=drawwindow.html title=drawWindow>drawWindow()</a></li><li><a class=sidemenu-item href=ellipse.html title=ellipse>ellipse()</a></li><li><a class=sidemenu-item href=fill.html title=fill>fill()</a></li><li><a class=sidemenu-item href=fillrect.html title=fillRect>fillRect()</a></li><li><a class=sidemenu-item href=filltext.html title=fillText>fillText()</a></li><li><a class=sidemenu-item href=getimagedata.html title=getImageData>getImageData()</a></li><li><a class=sidemenu-item href=getlinedash.html title=getLineDash>getLineDash()</a></li><li><a class=sidemenu-item href=ispointinpath.html title=isPointInPath>isPointInPath()</a></li><li><a class=sidemenu-item href=ispointinstroke.html title=isPointInStroke>isPointInStroke()</a></li><li><a class=sidemenu-item href=lineto.html title=lineTo>lineTo()</a></li><li><a class=sidemenu-item href=measuretext.html title=measureText>measureText()</a></li><li><a class=sidemenu-item href=moveto.html title=moveTo>moveTo()</a></li><li><a class=sidemenu-item href=putimagedata.html title=putImageData>putImageData()</a></li><li><a class=sidemenu-item href=quadraticcurveto.html title=quadraticCurveTo>quadraticCurveTo()</a></li><li><a class=sidemenu-item href=rect.html title=rect>rect()</a></li><li><a class=sidemenu-item href=removehitregion.html title=removeHitRegion>removeHitRegion()</a></li><li><a class=sidemenu-item href=resettransform.html title=resetTransform>resetTransform()</a></li><li><a class=sidemenu-item href=restore.html title=restore>restore()</a></li><li><a class=sidemenu-item href=rotate.html title=rotate>rotate()</a></li><li><a class=sidemenu-item href=save.html title=save>save()</a></li><li><a class=sidemenu-item href=scale.html title=scale>scale()</a></li><li><a class=sidemenu-item href=scrollpathintoview.html title=scrollPathIntoView>scrollPathIntoView()</a></li><li><a class=sidemenu-item href=setlinedash.html title=setLineDash>setLineDash()</a></li><li><a class=sidemenu-item href=settransform.html title=setTransform>setTransform()</a></li><li><a class=sidemenu-item href=stroke.html title=stroke>stroke()</a></li><li><a class=sidemenu-item href=strokerect.html title=strokeRect>strokeRect()</a></li><li><a class=sidemenu-item href=stroketext.html title=strokeText>strokeText()</a></li><li><a class=sidemenu-item href=transform.html title=transform>transform()</a></li><li><a class=sidemenu-item href=translate.html title=translate>translate()</a></li></ul></nav><script>function menuinit(){let i=document.getElementById("main_menubox"),n="sidemenu-arrdown",t="sidemenu-arrleft";i.querySelectorAll(".sidemenu-label").forEach(i=>{i.onclick=()=>{let r=i.parentNode.querySelector(`.${n},.${t}`);r.classList.contains(n)?(r.classList.remove(n),r.classList.add(t),i.parentNode.parentNode.classList.add("sidemenu-group-close")):(r.classList.add(n),r.classList.remove(t),i.parentNode.parentNode.classList.remove("sidemenu-group-close"))}})}function currentMenu(){let t=window.location.pathname,r=t.substr(t.lastIndexOf("/")+1),u="#main_menubox [href='"+r+"']",n=document.querySelector(u);n.classList.add("active");n.classList.add("bg-grayse");let i=document.querySelector("#main_menubox").parentElement;i.scrollTo(0,n.offsetTop-i.clientHeight/2)}menuinit();currentMenu()</script></div><div class="grid-10 pd-20"><h2>globalCompositeOperation</h2><p>设置多个图形的混合模式,这个属性设定了在画新图形时采用的遮盖策略,其值是一个标识12种遮盖方式的字符串</p>
<pre class="bg-gray pd-tb-10">
  ctx.globalCompositeOperation = type;
</pre><br /><h4>测验</h4><p>先看最简单例子,两个矩形有重合区域,此时将此属性设为ctx.globalCompositeOperation = 'xor'</p><p>左侧是未设定时样子,右侧是设定后样式.可见设定'xor'后,重合区域透明了(重合区灰色是css背景色)</p><canvas id=canvas1></canvas><p>source-over 这个是默认值,可见设置后与不设置是一样的.后续绘制的图形会盖住之前的.</p><canvas id=canvas2></canvas><p>source-in 只在重叠区域上绘制,其它位置透明.</p><p>先看左图,画布上有3矩形1圆,位于左右的红色和位于中间的蓝色.注意蓝色矩形与左右矩形和中间圆的重叠处</p><p>再看右图,设置了该值以后.只剩下重叠的区域了.</p><p>可以认为是最后绘制上的图形与之前绘制的所有图形重合处区域保留,其它区域则清空透明.</p><div class=grids><canvas id=canvas3></canvas><canvas id=canvas4></canvas></div><p>source-out 这个正好与source-in相反,只在没有内容的地方绘画,其它区域清空透明</p><p>对比上左图,下图所绘制内容正是蓝色矩形不与其它图形重合的区域.</p><canvas id=canvas5></canvas><p>source-atop 只在与现有画布内容重叠的地方绘制</p><p>下图可见,绘画区域(蓝色)与souce-in相同.但是不清空其它区域</p><canvas id=canvas6></canvas><p>destination-over 在现有的画布内容后面绘制新的图形</p><p>下图可见,绘画区域(蓝色)与souce-out相同.但是不清空其它区域</p><canvas id=canvas7></canvas><p>destination-in 现有的画布内容保持在新图形和现有画布内容重叠的位置,其他的都是透明的</p><p>下图可见,最后绘画的蓝色矩形没有了,画布上保留的是蓝色矩形与之前绘画内容重叠的区域</p><p>这个区域与"source-in"一样,可认为是最后绘画的蓝色矩形是一个选定区域,但不会画出来</p><canvas id=canvas8></canvas><p>destination-out 现在画布内容保持与新图形不重叠的位置</p><p>下图可见,其效果是"destination-in"反向选择之后的结果.</p><p>可以认为是最后绘画的蓝色矩形是一个橡皮擦,擦除的范围是画布现有图形与它重合的区域</p><canvas id=canvas9></canvas><p>destination-atop 现有的画布只保留与新图形重叠的部分</p><p>下图可见,保留的是最后绘制的蓝色矩形范围,其中与原有内容重叠的区域,显示的是原内容,不重叠的区域显示的是蓝色</p><p>可认为是原始内容盖住了蓝色矩形区域</p><canvas id=canvas10></canvas><p>lighter 两个重叠图形的颜色是通过颜色值相加来确定的</p><p>经典的三原色合成图,看重叠部分的颜色,是由组成重叠的原颜色合成</p><canvas id=canvas11></canvas><p>copy 保留最后路径内的内容</p><p>看左图,画了很多东西,最后一个画的是红色圆.再看右图,画的东西一样多,但是加了copy属性,结果只剩下最后画的红色圆了</p><p>这说明copy属性,就像是从其它地方复制一份内容,并且会清空画布上其它内容</p><div class=grids><canvas id=canvas12></canvas><canvas id=canvas13></canvas></div><p>multiply 将顶层像素与底层相应像素相乘,结果是一幅更黑暗的图片</p><p>任然是三原色,看重叠区域的颜色.变黑色了,说明这个属性的将红绿蓝像素相乘的做法会加深颜色.具体怎么算的不研究了.</p><canvas id=canvas14></canvas><p>screen 像素被倒转,相乘,再倒转,结果是一幅更明亮的图片</p><p>任然是三原色,看重叠区域的颜色.变白色了,说明这个属性的将红绿蓝像素相乘的做法会减淡颜色.具体怎么算的不研究了.</p><canvas id=canvas15></canvas><p>overlay multiply和screen的结合,原本暗的地方更暗,原本亮的地方更亮</p><p>红灰表绿三种颜色,看重叠区域的颜色,是否如其所说.暗者愈暗,亮者愈亮.</p><canvas id=canvas16></canvas><p>darken 保留两个图层中最暗的像素</p><p>下图可见,重叠区域颜色深的保留了</p><canvas id=canvas17></canvas><p>lighten 保留两个图层中最亮的像素</p><p>下图可见,重叠区域颜色浅的保留了,这与"darken"正好相反</p><canvas id=canvas18></canvas><p>color-dodge 将底层除以顶层的反置</p><p>效果如下,算法未知</p><canvas id=canvas19></canvas><p>color-burn 将反置的底层除以顶层,然后将结果反过来</p><p>效果如下,算法未知</p><canvas id=canvas20></canvas><p>hard-light 屏幕相乘(A combination of multiply and screen)类似于叠加,但上下图层互换了</p><p>效果如下,算法未知</p><canvas id=canvas21></canvas><p>soft-light 用顶层减去底层或者相反来得到一个正值</p><p>效果如下,算法未知</p><canvas id=canvas22></canvas><p>difference 一个柔和版本的强光(hard-light).纯黑或纯白不会导致纯黑或纯白</p><p>效果如下,算法未知</p><canvas id=canvas23></canvas><p>exclusion 和difference相似,但对比度较低</p><p>效果如下,算法未知</p><canvas id=canvas24></canvas><p>hue 保留了底层的亮度(luma)和色度(chroma),同时采用了顶层的色调(hue)</p><p>效果如下,算法未知</p><canvas id=canvas25></canvas><p>saturation 保留底层的亮度(luma)和色调(hue),同时采用顶层的色度(chroma)</p><p>效果如下,算法未知</p><canvas id=canvas26></canvas><p>color 保留了底层的亮度(luma),同时采用了顶层的色调(hue)和色度(chroma)</p><p>效果如下,算法未知</p><canvas id=canvas27></canvas><p>luminosity 保持底层的色调(hue)和色度(chroma),同时采用顶层的亮度(luma)</p><p>效果如下,算法未知</p><canvas id=canvas28></canvas><h3>应用</h3><p>每个属性对应一种算法,在不了解算法意义时,很难明白为何出现这种效果,就难做好应用.这需要了解图形处理相关的知识</p><script>function test1(){let n=getCanvas2d("canvas1");n.beginPath();n.fillStyle="red";n.fillRect(30,30,50,50);n.fillStyle="green";n.fillRect(60,60,50,60);n.beginPath();n.moveTo(150,0);n.lineTo(150,150);n.stroke();n.beginPath();n.globalCompositeOperation="xor";n.fillRect(180,30,50,50);n.fillStyle="red";n.fillRect(200,60,50,60)}function test2(){let n=getCanvas2d("canvas2");n.beginPath();n.fillStyle="blue";n.fillRect(30,30,50,50);n.fillStyle="green";n.fillRect(60,60,50,60);n.beginPath();n.moveTo(150,0);n.lineTo(150,150);n.stroke();n.beginPath();n.globalCompositeOperation="source-over";n.fillRect(180,30,50,50);n.fillStyle="blue";n.fillRect(200,60,50,60)}function test3(){let n=getCanvas2d("canvas3");drawBase(n);drawByGco(n)}function test4(){let n=getCanvas2d("canvas4");drawBase(n);drawByGco(n,"source-in")}function test5(){let n=getCanvas2d("canvas5");drawBase(n);drawByGco(n,"source-out")}function test6(){let n=getCanvas2d("canvas6");drawBase(n);drawByGco(n,"source-atop")}function test7(){let n=getCanvas2d("canvas7");drawBase(n);drawByGco(n,"destination-over")}function test8(){let n=getCanvas2d("canvas8");drawBase(n);drawByGco(n,"destination-in")}function test9(){let n=getCanvas2d("canvas9");drawBase(n);drawByGco(n,"destination-out")}function test10(){let n=getCanvas2d("canvas10");drawBase(n);drawByGco(n,"destination-atop")}function test11(){let n=getCanvas2d("canvas11");n.save();n.globalCompositeOperation="lighter";drawColor3(n);n.restore();n.font="16px serail";n.beginPath();n.fillText("红绿叠加",10,40);n.moveTo(30,20);n.lineTo(150,30);n.stroke();n.beginPath();n.fillText("红蓝叠加",10,120);n.moveTo(30,100);n.lineTo(120,80);n.stroke();n.beginPath();n.fillText("绿蓝叠加",220,140);n.moveTo(180,90);n.lineTo(280,120);n.stroke();n.beginPath();n.fillText("红绿蓝叠加",210,20);n.moveTo(150,70);n.lineTo(240,30);n.stroke()}function test12(){let n=getCanvas2d("canvas12");n.beginPath();n.moveTo(150,0);n.lineTo(150,150);n.stroke();n.fillRect(10,10,50,20);n.fillRect(60,60,50,40);n.beginPath();n.arc(30,120,20,0,Math.PI*2);n.fill();n.save();n.beginPath();n.arc(180,120,20,0,Math.PI*2);n.fillStyle="red";n.fill();n.restore()}function test13(){let n=getCanvas2d("canvas13");n.beginPath();n.moveTo(150,0);n.lineTo(150,150);n.stroke();n.fillRect(10,10,50,20);n.fillRect(60,60,50,40);n.beginPath();n.arc(30,120,20,0,Math.PI*2);n.fill();n.save();n.globalCompositeOperation="copy";n.beginPath();n.arc(180,120,20,0,Math.PI*2);n.fillStyle="red";n.fill();n.restore()}function test14(){let n=getCanvas2d("canvas14");n.save();n.globalCompositeOperation="multiply";drawColor3(n);n.restore()}function test15(){let n=getCanvas2d("canvas15");n.save();n.globalCompositeOperation="screen";drawColor3(n);n.restore()}function test16(){let n=getCanvas2d("canvas16");n.globalCompositeOperation="overlay";drawColor3(n,1)}function test17(){let n=getCanvas2d("canvas17");n.globalCompositeOperation="darken";drawColor3(n,1)}function test18(){let n=getCanvas2d("canvas18");n.globalCompositeOperation="lighten";drawColor3(n,1)}function test19(){let n=getCanvas2d("canvas19");n.globalCompositeOperation="color-dodge";drawColor3(n,1)}function test20(){let n=getCanvas2d("canvas20");n.globalCompositeOperation="color-burn";drawColor3(n,1)}function test21(){let n=getCanvas2d("canvas21");n.globalCompositeOperation="hard-light";drawColor3(n,1)}function test22(){let n=getCanvas2d("canvas22");n.globalCompositeOperation="soft-light";drawColor3(n,1)}function test23(){let n=getCanvas2d("canvas23");n.globalCompositeOperation="difference";drawColor3(n,1)}function test24(){let n=getCanvas2d("canvas24");n.globalCompositeOperation="exclusion";drawColor3(n,1)}function test25(){let n=getCanvas2d("canvas25");n.globalCompositeOperation="hue";drawColor3(n,1)}function test26(){let n=getCanvas2d("canvas26");n.globalCompositeOperation="saturation";drawColor3(n,1)}function test27(){let n=getCanvas2d("canvas27");n.globalCompositeOperation="color";drawColor3(n,1)}function test28(){let n=getCanvas2d("canvas28");n.globalCompositeOperation="luminosity";drawColor3(n,1)}function drawBase(n){n.save();n.beginPath();n.fillStyle="red";n.fillRect(0,0,100,150);n.fillRect(200,0,100,150);n.fillStyle="brown";n.arc(150,75,40,0,Math.PI*2);n.fill();n.restore()}function drawColor3(n,t){n.save();n.beginPath();n.fillStyle=t?"#cc0000":"#ff0000";n.arc(125,55,50,0,Math.PI*2);n.fill();n.beginPath();n.fillStyle=t?"#f8f8f8":"#00ff00";n.arc(175,55,50,0,Math.PI*2);n.fill();n.beginPath();n.fillStyle=t?"#ccff00":"#0000ff";n.arc(150,100,50,0,Math.PI*2);n.fill();n.restore()}function drawByGco(n,t){n.save();n.beginPath();n.globalCompositeOperation=t;n.fillStyle="#003399";n.fillRect(80,50,140,50);n.restore()}function getCanvas2d(n){let t=document.querySelector("#"+n);t.style.display="block";t.style.margin="20px";t.style.backgroundColor="#f0f0f0";return t.getContext("2d")}test1();test2();test3();test4();test5();test6();test7();test8();test9();test10();test11();test12();test13();test14();test15();test16();test17();test18();test19();test20();test21();test22();test23();test24();test25();test26();test27();test28()</script></div></div></body></html>